<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 1.1em;
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .error {
            background: #fee;
            border: 2px solid #fcc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            color: #c33;
        }

        .file-list {
            list-style: none;
        }

        .file-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .file-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .file-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            text-decoration: none;
            color: #333;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-size: 1.2em;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
            word-break: break-word;
        }

        .file-date {
            font-size: 0.9em;
            color: #666;
        }

        .file-icon {
            font-size: 2em;
            margin-left: 20px;
            opacity: 0.7;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.8em;
            }

            .file-link {
                flex-direction: column;
                align-items: flex-start;
            }

            .file-icon {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –°–ø–∏—Å–æ–∫ –æ—Ç—á–µ—Ç–æ–≤</h1>
            <p>HTML —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ Result</p>
        </div>
        <div class="content">
            <div id="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</div>
            <div id="error" class="error" style="display: none;"></div>
            <ul id="fileList" class="file-list" style="display: none;"></ul>
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-state-icon">üìÅ</div>
                <p>–§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
            </div>
        </div>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—ã–π URL –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ GitHub Pages
        function getBaseUrl() {
            // –î–ª—è GitHub Pages –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é
            if (window.location.hostname.includes('github.io')) {
                const path = window.location.pathname.split('/').filter(p => p && p !== 'index.html');
                // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–µ–≥–º–µ–Ω—Ç—ã –ø—É—Ç–∏ (–∫—Ä–æ–º–µ index.html), –ø–µ—Ä–≤—ã–π - —ç—Ç–æ –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
                if (path.length > 0) {
                    const firstSegment = path[0];
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ñ–∞–π–ª –∏ –Ω–µ –ø–∞–ø–∫–∞ Result
                    if (firstSegment !== 'Result' && !firstSegment.includes('.')) {
                        return `/${firstSegment}`;
                    }
                }
            }
            return '';
        }
        
        // –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∞–±—Å–æ–ª—é—Ç–Ω—ã–π URL –¥–ª—è —Ñ–∞–π–ª–∞ –≤ Result
        function getResultFileUrl(fileName) {
            const baseUrl = getBaseUrl();
            return `${window.location.origin}${baseUrl}/Result/${fileName}`;
        }

        // –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞—Ç—É –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
        function extractDateFromFilename(filename) {
            const dateMatch = filename.match(/(\d{4})-?(\d{2})-?(\d{2})/);
            if (dateMatch) {
                const year = dateMatch[1];
                const month = dateMatch[2];
                const day = dateMatch[3];
                return new Date(year, parseInt(month) - 1, day);
            }
            return null;
        }

        // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ GitHub API
        async function fetchViaGitHubAPI() {
            try {
                const hostname = window.location.hostname;
                if (!hostname.includes('github.io')) {
                    return null;
                }

                const pathParts = window.location.pathname.split('/').filter(p => p);
                if (pathParts.length === 0) {
                    return null;
                }

                const repoOwner = hostname.split('.')[0];
                const repoName = pathParts[0];

                if (!repoOwner || !repoName) {
                    return null;
                }

                const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/Result`;
                const response = await fetch(apiUrl);

                if (!response.ok) {
                    return null;
                }

                const files = await response.json();
                const htmlFiles = files
                    .filter(file => file.type === 'file' && file.name.endsWith('.html'))
                    .map(file => {
                        const dateFromName = extractDateFromFilename(file.name);
                        return {
                            name: file.name,
                            url: getResultFileUrl(file.name),
                            date: dateFromName,
                            commitSha: file.sha
                        };
                    });

                // –ü–æ–ª—É—á–∞–µ–º –¥–∞—Ç—ã –∫–æ–º–º–∏—Ç–æ–≤ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                if (htmlFiles.length > 0) {
                    try {
                        const commitsUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/commits?path=Result/`;
                        const commitsResponse = await fetch(commitsUrl);
                        if (commitsResponse.ok) {
                            const commits = await commitsResponse.json();
                            const fileCommitMap = new Map();
                            
                            for (const commit of commits) {
                                for (const file of commit.files || []) {
                                    if (file.filename.startsWith('Result/') && file.filename.endsWith('.html')) {
                                        const fileName = file.filename.split('/').pop();
                                        if (!fileCommitMap.has(fileName)) {
                                            fileCommitMap.set(fileName, new Date(commit.commit.author.date));
                                        }
                                    }
                                }
                            }

                            htmlFiles.forEach(file => {
                                if (fileCommitMap.has(file.name)) {
                                    file.commitDate = fileCommitMap.get(file.name);
                                }
                            });
                        }
                    } catch (e) {
                        console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—ã –∫–æ–º–º–∏—Ç–æ–≤');
                    }
                }

                return htmlFiles;
            } catch (error) {
                return null;
            }
        }

        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥: –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã –Ω–∞–ø—Ä—è–º—É—é
        async function fetchFilesDirect() {
            const baseUrl = getBaseUrl();
            const resultUrl = `${baseUrl}/Result/`;
            
            // –ü–æ–ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã –∏–∑ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏–ª–∏ manifest
            const files = [];

            // –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ fallback –ø–æ—Å–ª–µ manifest.json

            // –ï—Å–ª–∏ manifest –Ω–µ—Ç, –ø—Ä–æ–±—É–µ–º –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã
            // –ú–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            const knownFiles = [
                'combatlog_report_2025-10-30.html'
            ];

            for (const fileName of knownFiles) {
                try {
                    const fileUrl = `${resultUrl}${fileName}`;
                    const response = await fetch(fileUrl, { method: 'HEAD' });
                    
                    if (response.ok) {
                        const lastModified = response.headers.get('Last-Modified');
                        const date = lastModified ? new Date(lastModified) : extractDateFromFilename(fileName);
                        
                        files.push({
                            name: fileName,
                            url: fileUrl,
                            date: date,
                            commitDate: null
                        });
                    }
                } catch (error) {
                    // –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
                }
            }

            return files.length > 0 ? files : null;
        }

        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã
        async function getAllFiles() {
            // –ú–µ—Ç–æ–¥ 1: –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å manifest.json (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±)
            const baseUrl = getBaseUrl();
            
            // –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—É—Ç–µ–π –∫ manifest.json
            const manifestPaths = [
                `${baseUrl}/Result/manifest.json`,
                baseUrl ? `/Result/manifest.json` : null, // –î–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ —Å–∞–π—Ç–∞
                `${window.location.origin}${baseUrl}/Result/manifest.json`,
                `${window.location.origin}/Result/manifest.json`
            ].filter(p => p !== null);
            
            for (const manifestUrl of manifestPaths) {
                try {
                    const manifestResponse = await fetch(manifestUrl);
                    if (manifestResponse.ok) {
                        const manifest = await manifestResponse.json();
                        if (manifest.files && Array.isArray(manifest.files) && manifest.files.length > 0) {
                            console.log('–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω manifest.json –∏–∑:', manifestUrl);
                            // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –¥–ª—è —Ñ–∞–π–ª–æ–≤
                            return manifest.files.map(f => ({
                                name: f.name,
                                url: getResultFileUrl(f.name),
                                date: f.date ? new Date(f.date) : extractDateFromFilename(f.name),
                                commitDate: f.commitDate ? new Date(f.commitDate) : (f.date ? new Date(f.date) : extractDateFromFilename(f.name))
                            }));
                        }
                    }
                } catch (e) {
                    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø—É—Ç–∏
                }
            }
            
            console.log('manifest.json –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º GitHub API');
            
            // –ú–µ—Ç–æ–¥ 2: GitHub API (–¥–ª—è GitHub Pages)
            let files = await fetchViaGitHubAPI();
            
            // –ú–µ—Ç–æ–¥ 3: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø
            if (!files || files.length === 0) {
                files = await fetchFilesDirect();
            }

            return files || [];
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
        function formatDate(date) {
            if (!date) {
                return '–î–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞';
            }

            const dateObj = date instanceof Date ? date : new Date(date);
            if (isNaN(dateObj.getTime())) {
                return '–î–∞—Ç–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞';
            }

            const now = new Date();
            const diff = now - dateObj;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));

            if (days === 0) {
                const hours = Math.floor(diff / (1000 * 60 * 60));
                if (hours === 0) {
                    const minutes = Math.floor(diff / (1000 * 60));
                    return minutes <= 1 ? '–¢–æ–ª—å–∫–æ —á—Ç–æ' : `${minutes} –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥`;
                }
                return `${hours} ${hours === 1 ? '—á–∞—Å' : hours < 5 ? '—á–∞—Å–∞' : '—á–∞—Å–æ–≤'} –Ω–∞–∑–∞–¥`;
            } else if (days === 1) {
                return '–í—á–µ—Ä–∞';
            } else if (days < 7) {
                return `${days} ${days === 1 ? '–¥–µ–Ω—å' : days < 5 ? '–¥–Ω—è' : '–¥–Ω–µ–π'} –Ω–∞–∑–∞–¥`;
            } else {
                return dateObj.toLocaleDateString('ru-RU', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
        function displayFiles(files) {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');
            const fileListEl = document.getElementById('fileList');
            const emptyStateEl = document.getElementById('emptyState');

            loadingEl.style.display = 'none';

            if (files.length === 0) {
                emptyStateEl.style.display = 'block';
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            files.sort((a, b) => {
                const dateA = a.commitDate || a.date;
                const dateB = b.commitDate || b.date;
                
                if (!dateA && !dateB) return 0;
                if (!dateA) return 1;
                if (!dateB) return -1;
                
                const dateObjA = dateA instanceof Date ? dateA : new Date(dateA);
                const dateObjB = dateB instanceof Date ? dateB : new Date(dateB);
                
                return dateObjB - dateObjA;
            });

            fileListEl.innerHTML = '';
            files.forEach(file => {
                const li = document.createElement('li');
                li.className = 'file-item';
                
                const date = file.commitDate || file.date;
                
                // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π URL –¥–ª—è GitHub Pages
                const fileUrl = getResultFileUrl(file.name);
                
                li.innerHTML = `
                    <a href="${fileUrl}" class="file-link" target="_blank">
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-date">${formatDate(date)}</div>
                        </div>
                        <div class="file-icon">üìÑ</div>
                    </a>
                `;
                
                fileListEl.appendChild(li);
            });

            fileListEl.style.display = 'block';
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
        function showError(message) {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error');
            
            loadingEl.style.display = 'none';
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
        async function init() {
            try {
                // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
                const baseUrl = getBaseUrl();
                console.log('Base URL:', baseUrl);
                console.log('Current path:', window.location.pathname);
                console.log('Hostname:', window.location.hostname);
                
                const files = await getAllFiles();
                
                if (files.length === 0) {
                    console.log('–§–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü—Ä–æ–≤–µ—Ä—è–µ–º manifest.json...');
                    // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –ø—É—Ç–µ–π
                    const pathsToTry = [
                        `${baseUrl}/Result/manifest.json`,
                        `/Result/manifest.json`,
                        `Result/manifest.json`,
                        `${window.location.origin}/Result/manifest.json`
                    ];
                    
                    for (const path of pathsToTry) {
                        try {
                            const response = await fetch(path);
                            if (response.ok) {
                                console.log('–ù–∞–π–¥–µ–Ω manifest.json –ø–æ –ø—É—Ç–∏:', path);
                                const manifest = await response.json();
                                if (manifest.files && manifest.files.length > 0) {
                                    // –§–æ—Ä–º–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –¥–ª—è —Ñ–∞–π–ª–æ–≤
                                    const files = manifest.files.map(f => ({
                                        name: f.name,
                                        url: getResultFileUrl(f.name),
                                        date: f.date ? new Date(f.date) : extractDateFromFilename(f.name),
                                        commitDate: f.commitDate ? new Date(f.commitDate) : (f.date ? new Date(f.date) : extractDateFromFilename(f.name))
                                    }));
                                    displayFiles(files);
                                    return;
                                }
                            }
                        } catch (e) {
                            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø—É—Ç–∏
                        }
                    }
                }
                
                displayFiles(files);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showError('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π. ' + 
                         '–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—É–±–ª–∏—á–Ω—ã–π –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ GitHub Actions –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ manifest.json.');
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        init();
    </script>
</body>
</html>
